<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Trang Chủ Trọ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="app-layout">
  <!-- Top bar for mobile: hamburger button -->
  <header class="topbar" aria-label="Thanh điều hướng di động">
    <button id="hamburger-btn" class="hamburger" type="button" aria-label="Mở menu" aria-controls="app-menu" aria-expanded="false">☰</button>
  </header>
  <nav class="menu">
    <button class="menu-item" id="menu-profile">Thông tin cá nhân</button>
    <button class="menu-item" id="menu-verify">Xác nhận chủ trọ</button>
    <button class="menu-item" id="menu-post">Đăng bài</button>
    <button class="menu-item" id="menu-manage" type="button">Quản lý phòng</button>
  <button class="menu-item" id="menu-feedback">Phản hồi ADMIN</button>
  <button class="menu-item" id="menu-noti">Thông báo</button>
    <button class="menu-item" id="menu-logout" type="button">Đăng xuất</button>
  </nav>

  <main class="content">
    <h2 class="page-title">Trang Chủ Trọ</h2>
    <!-- (Admin contact moved to page footer per request) -->

    <section id="panel-profile" class="panel" style="display:none">
      <form id="frm-profile">
        <div class="form-group">
          <label>Gmail</label>
          <input type="email" id="email" readonly>
        </div>
        <div class="form-group">
          <label>Họ tên</label>
          <input type="text" id="hoTen" maxlength="100">
        </div>
        <div class="form-group">
          <label>Số điện thoại</label>
          <input type="tel" id="soDienThoai" maxlength="20">
        </div>
        <div class="form-group">
          <label>Địa chỉ liên hệ</label>
          <input type="text" id="diaChiLienHe" maxlength="255">
        </div>

        <button type="submit">Lưu thông tin</button>
        <div class="switch"><a href="/chutro">Quay lại trang chính</a></div>
      </form>
    </section>

    <section id="panel-verify" class="panel" style="display:none">
      <h3>Xác nhận chủ trọ</h3>
      <p id="verify-status-text">Trạng thái: đang kiểm tra...</p>
      <form id="frm-verify">
        <div class="form-group">
          <label>Loại giấy tờ</label>
          <select id="loaiGiayTo" required>
            <option value="GiayPhepKinhDoanh">Giấy phép kinh doanh</option>
            <option value="CMND/CCCD+SoHoKhau">CMND/CCCD + Sổ hộ khẩu</option>
            <option value="GiayToKhac">Giấy tờ tương đương</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tải lên minh chứng (ảnh)</label>
          <input type="file" id="fileMinhChung" accept="image/jpeg,image/png" required>
          <img id="verify-preview" alt="Xem trước minh chứng" style="display:none;max-width:320px;margin-top:8px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15)" />
        </div>
        <button type="submit">Gửi xác thực</button>
      </form>
      <small>Lưu ý: Đây là quy trình bắt buộc trước khi đăng tin.</small>
    </section>

    <section id="panel-post" class="panel" style="display:none">
      <h3>Đăng bài</h3>
      <div id="post-guard" style="color:#b91c1c; font-weight:600; margin-bottom:8px;">Bạn chưa được xác thực. Vui lòng hoàn tất xác thực để đăng tin.</div>

      <form id="frm-room">
        <h4>Tạo phòng mới</h4>
        <div class="form-group"><label>Tiêu đề</label><input id="room-title" maxlength="150" required></div>
        <div class="form-group"><label>Mô tả</label><textarea id="room-desc" rows="3"></textarea></div>

        <!-- ẨN các trường vị trí (giữ lại Link Google Map hiển thị riêng) -->
        <div style="display:none">
          <div class="form-group"><label>Địa chỉ</label><input id="room-diachi" maxlength="255"></div>
          <div class="form-row" style="display:flex;gap:10px">
            <div class="form-group" style="flex:1"><label>Phường/Xã</label><input id="room-phuongxa" maxlength="100"></div>
            <div class="form-group" style="flex:1"><label>Quận/Huyện</label><input id="room-quanhuyen" maxlength="100"></div>
            <div class="form-group" style="flex:1"><label>Thành phố</label><input id="room-thanhpho" maxlength="100" value="Thai Nguyen"></div>
          </div>
        </div>

        <!-- Hiển thị Link Google Map để chủ trọ dán link vị trí -->
        <div class="form-group"><label>Link Google Map</label><input id="room-mapurl" placeholder="Dán liên kết Google Maps (ví dụ: https://goo.gl/maps/...) "></div>

        <div class="form-row" style="display:flex;gap:10px">
          <div class="form-group" style="flex:1"><label>Diện tích (m²)</label><input type="number" step="0.01" id="room-dientich"></div>
          <div class="form-group" style="flex:1"><label>Giá cơ bản</label><input type="number" step="0.01" id="room-gia" required></div>
          <div class="form-group" style="flex:1"><label>Số người tối đa</label><input type="number" id="room-songuoitoida"></div>
        </div>
        <div class="form-group">
          <label>Tiện ích</label>
          <div id="tienich-list" style="display:flex;flex-wrap:wrap;gap:10px"></div>
        </div>
        <button type="submit">Tạo phòng</button>
      </form>

      <hr style="margin:16px 0">

      <!-- New: chọn phòng để tải ảnh -->
      <div class="form-group">
        <label>Phòng của bạn</label>
        <select id="post-room-select"></select>
      </div>

      <!-- Upload nhiều ảnh cho phòng -->
      <form id="frm-post">
        <div class="form-group">
          <label>PhongId</label>
          <input type="number" id="post-phongId" placeholder="Nhập/đã chọn PhongId" required>
        </div>
        <div class="form-group">
          <label>Ảnh phòng (có thể chọn nhiều)</label>
          <input type="file" id="post-files" accept="image/jpeg,image/png" multiple required>
        </div>
        <button type="submit">Tải ảnh lên</button>
      </form>

      <div style="margin-top:12px">
        <h4>Ảnh đã đăng</h4>
        <div id="post-gallery" style="display:flex;flex-wrap:wrap;gap:10px"></div>
      </div>
    </section>

    <!-- NEW: Quản lý trọ -->
    <section id="panel-manage" class="panel" style="display:none">
      <h3>Quản lý trọ</h3>

      <!-- Thanh menu chức năng (ngang) -->
      <div class="tabbar" id="manage-tabbar" role="tablist" aria-label="Chức năng quản lý">
        <button type="button" class="tab-item active" data-tab="requests" aria-selected="true">Yêu cầu thuê</button>
        <button type="button" class="tab-item" data-tab="payments" aria-selected="false">Tiền trọ</button>
        <button type="button" class="tab-item" data-tab="rooms" aria-selected="false">Phòng của bạn</button>
      </div>

      <!-- Select dự phòng (ẩn) cho thiết bị cũ / hỗ trợ bàn phím -->
      <div class="form-group" style="max-width:260px; display:none">
        <label>Chức năng</label>
        <select id="manage-tab">
          <option value="requests">Yêu cầu thuê</option>
          <option value="payments">Tiền trọ</option>
          <option value="rooms">Phòng của bạn</option>
        </select>
      </div>

      <!-- Tab: Yêu cầu thuê -->
      <div id="tab-requests">
        <h4>Xác nhận sinh viên</h4>
        <div id="rr-list">
          <em>Đang tải danh sách yêu cầu...</em>
        </div>
      </div>

      <hr>

      <!-- Tab: Tiền trọ -->
      <div id="tab-payments" style="display:none">
        <h4>Tiền trọ</h4>
        <form id="frm-payment" style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
          <div class="form-group" style="min-width:220px">
            <label>Hợp đồng/Phòng</label>
            <select id="pay-contract" required>
              <option value="">Đang tải...</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tháng</label>
            <input type="month" id="pay-month" required>
          </div>
          <div class="form-group">
            <label>Tổng tiền (VND)</label>
            <input type="number" id="pay-amount" step="0.01" min="0" required placeholder="Ví dụ: 1200000">
          </div>
          <div class="form-group">
            <label>Số điện</label>
            <input type="number" id="pay-electric" min="0" placeholder="kWh (tuỳ chọn)">
          </div>
          <div class="form-group">
            <label>Số nước</label>
            <input type="number" id="pay-water" min="0" placeholder="m³ (tuỳ chọn)">
          </div>
          <div class="form-group" style="min-width:260px">
            <label>Ghi chú</label>
            <input type="text" id="pay-note" maxlength="500" placeholder="Ví dụ: đã bao gồm phí...">
          </div>
          <button type="submit">Lưu tiền trọ</button>
        </form>
        <div id="pay-history" style="margin-top:8px"></div>
      </div>

      <!-- Tab: Phòng -->
      <div id="tab-rooms" style="display:none;margin-top:16px">
        <h4>Phòng của bạn</h4>
        <div id="manage-rooms"></div>
      </div>
    </section>
    
    <!-- NEW: Phản hồi ADMIN -->
    <section id="panel-feedback" class="panel" style="display:none">
      <h3>Gửi phản hồi tới Admin</h3>
      <form id="frm-feedback" style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
        <div class="form-group">
          <label>Loại</label>
          <select id="fb-type" required>
            <option value="gopy">Góp ý</option>
            <option value="suco">Sự cố</option>
            <option value="khieunai">Khiếu nại</option>
            <option value="tocao">Tố cáo</option>
          </select>
        </div>
        <div class="form-group" style="min-width:260px;flex:1">
          <label>Tiêu đề</label>
          <input type="text" id="fb-title" maxlength="200" required placeholder="Nhập tiêu đề">
        </div>
        <div class="form-group" style="width:100%">
          <label>Nội dung</label>
          <textarea id="fb-content" rows="4" maxlength="1000" required placeholder="Mô tả chi tiết"></textarea>
        </div>
        <button type="submit">Gửi phản hồi</button>
      </form>
    </section>

    <!-- NEW: Thông báo của tôi (Chủ trọ) -->
    <section id="panel-noti" class="panel" style="display:none">
      <h3>Thông báo</h3>
      <div class="form-row" style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
        <div class="form-group">
          <label>Loại</label>
          <select id="noti-type">
            <option value="all" selected>Tất cả</option>
            <option value="Ban">Bị khóa</option>
            <option value="Unban">Mở khóa</option>
            <option value="YeuCauThue">Yêu cầu thuê</option>
            <option value="Thue">Đã thuê</option>
            <option value="XacThuc">Xác thực</option>
          </select>
        </div>
        <label class="form-group" style="display:flex;gap:6px;align-items:center;margin:0">
          <input type="checkbox" id="noti-unread"> Chỉ hiện chưa đọc
        </label>
  <button type="button" id="noti-refresh" class="btn btn-sm">Tải lại</button>
      </div>

      <table id="noti-table" class="table table-compact table-striped">
        <colgroup>
          <col style="width:88px">
          <col style="width:160px">
          <col style="width:260px">
          <col>
          <col style="width:120px">
        </colgroup>
        <thead>
          <tr><th>ID</th><th>Loại</th><th>Tiêu đề</th><th>Nội dung</th><th>Thao tác</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Footer admin contact (bottom inside main content) -->
    <footer class="support-footer" id="support-footer">
      <strong>Hỗ trợ:</strong>
      <span id="sf-name">Quản trị viên</span>
      <span class="dot">•</span>
      <a id="sf-phone" href="#">SĐT</a>
      <span class="dot">•</span>
      <a id="sf-zalo" href="#" target="_blank" rel="noopener">Zalo</a>
      <span class="dot">•</span>
      <a id="sf-fb" href="#" target="_blank" rel="noopener">Facebook</a>
    </footer>
  </main>

  <!-- Bottom navigation removed per request (hamburger menu replaces it on mobile) -->

  <!-- Overlay for drawer -->
  <div id="drawer-overlay" class="drawer-overlay" hidden></div>

  <!-- Modal sửa phòng -->
  <div id="edit-modal-backdrop" class="modal-backdrop" style="display:none">
    <div class="modal">
      <h3>Sửa phòng</h3>
      <form id="frm-edit-room">
        <input type="hidden" id="edit-room-id">
        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>Tiêu đề</label>
            <input id="edit-title" maxlength="150">
          </div>
          <div class="form-group" style="flex:1">
            <label>Giá cơ bản</label>
            <input id="edit-price" type="number" step="0.01">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>Diện tích (m²)</label>
            <input id="edit-area" type="number" step="0.01">
          </div>
          <div class="form-group" style="flex:1">
            <label>Số người tối đa</label>
            <input id="edit-max" type="number">
          </div>
        </div>
        <div class="form-group">
          <label>Link Google Map</label>
          <input id="edit-map" placeholder="https://maps.app.goo.gl/...">
        </div>
        <div class="form-group">
          <label>Tiện ích</label>
          <div id="edit-tienich-list" style="display:flex;flex-wrap:wrap;gap:10px"></div>
        </div>
        <div class="form-group">
          <label>Mô tả</label>
          <textarea id="edit-desc" rows="3"></textarea>
        </div>
        <hr style="margin:12px 0">
        <div class="form-group">
          <label>Ảnh phòng (chọn để tải lên)</label>
          <input type="file" id="edit-files" accept="image/jpeg,image/png" multiple>
        </div>
        <div id="edit-gallery" style="display:flex;flex-wrap:wrap;gap:10px"></div>
        <div style="display:flex;gap:10px;justify-content:flex-end">
          <button type="button" id="edit-cancel" class="btn btn-outline btn-sm" style="min-width:100px">Hủy</button>
          <button type="submit" class="btn btn-success btn-sm" style="min-width:140px">Lưu thay đổi</button>
        </div>
      </form>
    </div>
  </div>

  <div id="hop-thong-bao-nen" style="display:none">
    <div id="hop-thong-bao">
      <div id="hop-thong-bao-noi-dung"></div>
      <button id="hop-thong-bao-dong">Đóng</button>
    </div>
  </div>

  <script>
    // Admin contact config (có thể chỉnh sửa nhanh tại đây)
    const ADMIN_CONTACT = {
      hoTen: 'Quản trị viên',
      sdt: '0921224974',
      zalo: 'https://zalo.me/0921224974',
      fb: 'https://www.facebook.com/share/1N48br4N8F/?mibextid=wwXIfr',
      email: 'admin@gmail.com'
    };
    document.addEventListener('DOMContentLoaded', function(){
      const nm = document.getElementById('sf-name');
      const ph = document.getElementById('sf-phone');
      const zl = document.getElementById('sf-zalo');
      const fb = document.getElementById('sf-fb');
      if (nm) nm.textContent = ADMIN_CONTACT.hoTen || 'Quản trị viên';
      if (ph) { ph.textContent = ADMIN_CONTACT.sdt || '—'; ph.href = ADMIN_CONTACT.sdt ? `tel:${ADMIN_CONTACT.sdt}` : '#'; }
      if (zl) { zl.href = ADMIN_CONTACT.zalo || '#'; zl.target = '_blank'; zl.rel = 'noopener'; }
      if (fb) { fb.href = ADMIN_CONTACT.fb || '#'; fb.target = '_blank'; fb.rel = 'noopener'; }
    });
  </script>
  <script defer src="/chutro.js"></script>
</body>
</html>
